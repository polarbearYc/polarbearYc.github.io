<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI化学工具箱 - 交互界面</title>
    <!-- 外部 CSS 和字体 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- (新) 所有 CSS 合并到此处 -->
    <style>
        /* :root (CSS 变量) 和基础重置 */
        :root {
            --primary-color: #1a73e8;
            --primary-dark: #0d47a1;
            --secondary-color: #34a853;
            --dark-color: #202124;
            --gray-dark: #5f6368;
            --gray-medium: #dadce0;
            --gray-light: #f1f3f4;
            --light-color: #f8f9fa;
            --white: #ffffff;
            --spacing-xs: 4px;
            --spacing-small: 8px;
            --spacing-medium: 16px;
            --spacing-large: 24px;
            --spacing-xl: 32px;
            --font-main: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            --font-size-base: 14px;
            --font-size-lg: 18px;
            --font-size-xl: 24px;
            --shadow-sm: 0 1px 2px 0 rgba(60,64,67,0.3);
            --shadow-md: 0 2px 6px 2px rgba(60,64,67,0.15);
            --shadow-lg: 0 4px 12px 4px rgba(60,64,67,0.15);
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-main);
            font-size: var(--font-size-base);
            color: var(--dark-color);
            background-color: var(--light-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
            line-height: 1.5;
            overflow: hidden; /* 防止 body 滚动 */
        }

        /* 顶部导航样式 */
        .app-header {
            background-color: var(--dark-color);
            color: var(--white);
            padding: var(--spacing-medium);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-md);
            z-index: 10;
            flex-shrink: 0;
        }

        .logo {
            font-size: var(--font-size-xl);
            font-weight: bold;
            display: flex;
            align-items: center;
        }

        .logo-icon {
            margin-right: var(--spacing-small);
            color: var(--secondary-color);
        }

        .user-nav {
            display: flex;
            align-items: center;
            gap: var(--spacing-medium);
        }

        .nav-button {
            background: none;
            border: none;
            color: var(--white);
            cursor: pointer;
            padding: var(--spacing-xs) var(--spacing-small);
            border-radius: var(--radius-sm);
            transition: background-color 0.2s;
        }

        .nav-button:hover:not(:disabled) {
            background-color: rgba(255,255,255,0.1);
        }
        .nav-button:disabled {
            color: var(--gray-dark);
            cursor: not-allowed;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0.6;
        }

        /* 主容器布局 */
        .app-container {
            display: flex;
            flex: 1;
            overflow: hidden; /* 关键: 允许 .workspace 内部滚动 */
        }

        /* 侧边栏样式 */
        .sidebar {
            width: 240px;
            background-color: var(--white);
            border-right: 1px solid var(--gray-medium);
            padding: var(--spacing-medium) 0;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            transition: width 0.3s;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-menu li {
            padding: var(--spacing-small) var(--spacing-medium);
            margin: 0 var(--spacing-small);
            border-radius: var(--radius-sm);
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: all 0.2s;
        }

        .nav-menu li:hover {
            background-color: var(--gray-light);
        }

        .nav-menu li.active {
            background-color: var(--primary-color);
            color: var(--white);
        }

        .nav-menu li i {
            margin-right: var(--spacing-small);
            width: 20px;
            text-align: center;
        }

        .sidebar-footer {
            margin-top: auto;
            padding: var(--spacing-medium);
            border-top: 1px solid var(--gray-medium);
            font-size: 12px;
            color: var(--gray-dark);
        }

        /* 主工作区样式 */
        .workspace {
            flex: 1;
            padding: var(--spacing-large);
            overflow-y: auto;
            background-color: var(--light-color);
        }

        /* 页面切换逻辑 */
        .workspace-page {
            display: none; /* 默认所有页面都隐藏 */
        }
        .workspace-page.active-page {
            display: block; /* 只有激活的页面显示 */
        }

        /* 首页特定布局 */
        #page-home {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto 1fr;
            gap: var(--spacing-large);
            height: 100%;
        }
        #toolbox-section-home {
            grid-column: 1 / 3;
            grid-row: 1 / 2;
        }
        #case-library-home {
            grid-column: 1 / 2;
            grid-row: 2 / 3;
            overflow-y: auto;
            /* (新) 为首页列表添加最小高度 */
            min-height: 300px;
        }
        #ai-chatbox-home {
            grid-column: 2 / 3;
            grid-row: 2 / 3;
        }

        /* 完整案例库页面 */
        #page-cases .filter-section {
            background: var(--white);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
        }
        #cases-container-full {
            max-height: calc(100vh - 280px); /* 视口高度减去导航和筛选框 */
            overflow-y: auto;
        }

        /* 完整AI聊天页面 */
        #page-ai-lab {
            height: 100%;
            padding: 0;
            display: flex;
        }
        #ai-chatbox-full {
            flex: 1; /* 占满整个页面 */
        }

        /* (新) 案例库列表样式 (替换卡片) */
        .case-list-item {
            padding: var(--spacing-medium);
            border: 1px solid var(--gray-medium);
            border-radius: var(--radius-sm);
            background-color: var(--white);
            margin-bottom: var(--spacing-small);
            transition: all 0.2s;
        }
        .case-list-item:hover {
            box-shadow: var(--shadow-sm);
            transform: translateY(-2px);
        }
        .case-title {
            font-weight: 600;
            color: var(--primary-dark);
            margin-bottom: var(--spacing-xs);
        }
        .case-description {
            font-size: 13px;
            color: var(--dark-color);
            margin-bottom: var(--spacing-small);
        }
        .case-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .case-tags span {
            margin-right: var(--spacing-small);
        }
        .case-link {
            text-decoration: none;
            font-weight: 600;
        }

        /* (新) 工具详情页样式 */
        .tool-detail-page {
            background-color: var(--white);
            border-radius: var(--radius-md);
            padding: var(--spacing-large);
            box-shadow: var(--shadow-sm);
        }
        .btn-back {
            margin-bottom: var(--spacing-medium);
        }
        .install-steps {
            list-style-type: decimal;
            margin-left: 20px;
            margin-top: var(--spacing-medium);
        }
        .install-steps li {
            margin-bottom: var(--spacing-medium);
        }
        .install-steps code {
            background-color: var(--gray-light);
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            color: #c7254e; /* Bootstrap 风格的 code 颜色 */
        }

        /* 通用组件 */
        .toolbox-section,
        .case-library,
        .ai-chatbox {
            background-color: var(--white);
            border-radius: var(--radius-md);
            padding: var(--spacing-large);
            box-shadow: var(--shadow-sm);
            display: flex;
            flex-direction: column;
        }
        
        .case-library {
            overflow: hidden; /* 防止子元素溢出 */
        }

        .section-title {
            font-size: var(--font-size-lg);
            margin-bottom: var(--spacing-large);
            color: var(--primary-dark);
            display: flex;
            align-items: center;
        }
        .section-title i {
            margin-right: var(--spacing-small);
            color: var(--primary-color);
        }

        /* 工具箱 */
        .toolbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: var(--spacing-large);
        }
        .toolbox-item {
            background-color: var(--gray-light);
            border-radius: var(--radius-md);
            padding: var(--spacing-medium);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        .toolbox-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-color);
        }
        .toolbox-icon {
            width: 60px;
            height: 60px;
            background-color: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: var(--spacing-medium);
            color: var(--white);
            font-size: 24px;
        }
        .toolbox-name {
            font-weight: bold;
            margin-bottom: var(--spacing-xs);
        }
        .toolbox-desc {
            font-size: 12px;
            color: var(--gray-dark);
        }

        /* AI聊天框 */
        .ai-chatbox {
            padding: 0;
            min-height: 400px; /* 确保聊天框有最小高度 */
        }
        .chat-header {
            padding: var(--spacing-medium);
            border-bottom: 1px solid var(--gray-medium);
            display: flex;
            align-items: center;
            font-weight: 600;
        }
        .chat-header i {
            margin-right: var(--spacing-small);
            color: var(--primary-color);
        }
        .chat-messages {
            flex: 1;
            padding: var(--spacing-medium);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        .message {
            margin-bottom: var(--spacing-medium);
            max-width: 80%;
            padding: var(--spacing-small) var(--spacing-medium);
            border-radius: var(--radius-md);
        }
        .message.ai {
            align-self: flex-start;
            background-color: var(--gray-light);
            border-radius: 0 var(--radius-md) var(--radius-md) var(--radius-md);
        }
        .message.user {
            align-self: flex-end;
            background-color: var(--primary-color);
            color: var(--white);
            border-radius: var(--radius-md) 0 var(--radius-md) var(--radius-md);
        }
        .chat-input {
            display: flex;
            padding: var(--spacing-medium);
            border-top: 1px solid var(--gray-medium);
        }
        .chat-input input {
            flex: 1;
            padding: var(--spacing-small);
            border: 1px solid var(--gray-medium);
            border-radius: var(--radius-md) 0 0 var(--radius-md);
            outline: none;
        }
        .chat-input button {
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            padding: 0 var(--spacing-large);
            border-radius: 0 var(--radius-md) var(--radius-md) 0;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .chat-input button:hover {
            background-color: var(--primary-dark);
        }

        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: var(--white);
            border-radius: var(--radius-md);
            width: 80%;
            max-width: 800px; /* 恢复宽度以显示模拟工具 */
            max-height: 80vh;
            overflow-y: auto;
            padding: var(--spacing-large);
            box-shadow: var(--shadow-lg);
            position: relative;
        }
        .close-modal {
            position: absolute;
            top: var(--spacing-medium);
            right: var(--spacing-medium);
            font-size: var(--font-size-lg);
            cursor: pointer;
            color: var(--gray-dark);
        }
        .modal-title {
            font-size: var(--font-size-lg);
            margin-bottom: var(--spacing-large);
            color: var(--primary-dark);
        }

        /* (保留) 模拟工具所需的占位符 */
         .molecule-viewer {
            width: 100%;
            height: 300px;
            background-color: #f5f5f5;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        .molecule-viewer::before {
            content: "3D/2D 可视化区域 (模拟)";
            position: absolute;
            color: #999;
            font-size: 16px;
        }


        /* 响应式设计 */
        @media (max-width: 992px) {
            #page-home {
                grid-template-columns: 1fr; /* 单列布局 */
                grid-template-rows: auto auto 1fr;
            }
            #toolbox-section-home { grid-column: 1 / 2; grid-row: 1 / 2; }
            #case-library-home { grid-column: 1 / 2; grid-row: 2 / 3; }
            #ai-chatbox-home { grid-column: 1 / 2; grid-row: 3 / 4; }
            
            .tool-detail-page .row {
                flex-direction: column-reverse; /* 移动设备上，详情在上方 */
            }
            .tool-detail-page .col-md-5 {
                margin-bottom: var(--spacing-large);
            }
        }

        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                flex-direction: row;
                padding: 0;
                overflow-x: auto;
                border-bottom: 1px solid var(--gray-medium);
                border-right: none;
            }
            .nav-menu {
                display: flex;
            }
            .nav-menu li {
                white-space: nowrap;
            }
            .sidebar-footer {
                display: none;
            }
            .toolbox-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            .modal-content {
                width: 95%;
                padding: var(--spacing-medium);
            }
        }
    </style>
</head>
<body>

    <!-- 顶部导航栏 -->
    <header class="app-header">
        <div class="logo">
            <i class="fas fa-flask logo-icon"></i>
            <span>AI化学工具箱</span>
        </div>
        <nav class="user-nav">
            <!-- (新) 帮助按钮现在打开模态框 -->
            <button class="nav-button" id="help-button"><i class="fas fa-question-circle"></i> 帮助</button>
            <!-- (新) 设置按钮被禁用，但保留 -->
            <button class="nav-button" id="settings-button" disabled><i class="fas fa-cog"></i> 设置</button>
            <div class="user-avatar" id="user-avatar" title="登录功能待开发">
                <i class="fas fa-user"></i>
            </div>
        </nav>
    </header>

    <div class="app-container">
        <!-- 左侧导航 -->
        <aside class="sidebar">
            <ul class="nav-menu">
                <li class="active" data-page="home">
                    <i class="fas fa-home"></i>
                    <span>首页</span>
                </li>
                <li data-page="toolbox">
                    <i class="fas fa-toolbox"></i>
                    <span>工具箱</span>
                </li>
                <li data-page="cases">
                    <i class="fas fa-book"></i>
                    <span>案例库</span>
                </li>
                <li data-page="ai-lab">
                    <i class="fas fa-robot"></i>
                    <span>AI助手</span>
                </li>
                <!-- (新) 删除了未实现的 "数据分析" 导航 -->
            </ul>
            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-name">访客用户</div>
                    <div class="user-status">未登录</div>
                </div>
            </div>
        </aside>

        <!-- 主工作区 -->
        <main class="workspace">
            
            <!-- 页面1: 首页 (默认显示) -->
            <div id="page-home" class="workspace-page active-page">
                <!-- 工具箱区域 (首页版) -->
                <div class="toolbox-section" id="toolbox-section-home">
                    <div class="section-title">
                        <i class="fas fa-toolbox"></i>
                        <span>Syslab APP 工具箱</span>
                    </div>
                    <div class="toolbox-grid">
                        <!-- (新) CST 建模 APP (真实) -->
                        <div class="toolbox-item" data-tool="syslab-cst">
                            <div class="toolbox-icon" style="background-color: #0d47a1;">
                                <i class="fas fa-cube"></i>
                            </div>
                            <div class="toolbox-name">CST 超表面建模</div>
                            <div class="toolbox-desc">相位计算并生成VBS脚本 (Syslab APP)</div>
                        </div>
                        <!-- (新) 动力学 APP (真实) -->
                        <div class="toolbox-item" data-tool="syslab-kinetics">
                            <div class="toolbox-icon" style="background-color: #34a853;">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="toolbox-name">化学动力学Pro</div>
                            <div class="toolbox-desc">A+B ⇌ C+D 可逆反应模拟 (Syslab APP)</div>
                        </div>
                         <!-- (保留) 分子轨道 (模拟) -->
                        <div class="toolbox-item" data-tool="orbital">
                            <div class="toolbox-icon">
                                <i class="fas fa-atom"></i>
                            </div>
                            <div class="toolbox-name">分子轨道可视化</div>
                            <div class="toolbox-desc">原子轨道分布图和电子云可视化</div>
                        </div>
                        <!-- (保留) 电化学 (模拟) -->
                        <div class="toolbox-item" data-tool="electrochemistry">
                            <div class="toolbox-icon">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <div class="toolbox-name">电化学参数计算</div>
                            <div class="toolbox-desc">最小二乘迭代解法计算动力学参数</div>
                        </div>
                    </div>
                </div>
                <!-- 案例库区域 (首页版) -->
                <div class="case-library" id="case-library-home">
                    <div class="section-title">
                        <i class="fas fa-book"></i>
                        <span>AI+化学 热门案例</span>
                    </div>
                    <!-- (新) 列表式案例 -->
                    <div class="list-group" id="cases-container-home">
                        <!-- JS 动态加载 -->
                    </div>
                </div>
                <!-- AI聊天框 (首页版) -->
                <div class="ai-chatbox" id="ai-chatbox-home">
                    <div class="chat-header">
                        <i class="fas fa-robot"></i>
                        <span>化学AI助手 (模拟)</span>
                    </div>
                    <div class="chat-messages" id="chat-messages-home">
                        <div class="message ai">
                            您好！我是化学AI助手，可以回答您关于化学计算、分子可视化等各种问题。
                        </div>
                    </div>
                    <div class="chat-input">
                        <input type="text" id="chat-input-home" placeholder="输入您的问题...">
                        <button id="send-message-home"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>

            <!-- (新) 页面2: 工具箱详情页 (Syslab CST) -->
            <div id="page-tool-cst" class="workspace-page tool-detail-page">
                <button class="btn btn-light btn-sm btn-back" data-target="toolbox"><i class="fas fa-arrow-left me-2"></i>返回工具箱</button>
                <div class="section-title mt-3">
                    <i class="fas fa-cube" style="color: #0d47a1;"></i>
                    <span>CST 超表面自动建模</span>
                </div>
                <div class="row">
                    <div class="col-md-7">
                        <h4>功能介绍</h4>
                        <p>本工具是为电磁超表面设计而开发的 Syslab 桌面应用 (APP)。它集成了参数化的相位分布计算（如涡旋波、波束偏转、馈源补偿）和 CST Studio Suite™ 的自动化建模接口。</p>
                        <p>用户在 APP 中输入所需物理参数后，APP 会自动计算出超表面阵列所需的相位矩阵。之后，APP 会**生成一个 `.vbs` 脚本**。用户只需将此脚本拖入 CST 模板工程中，即可在几秒钟内自动完成整个阵列的创建，极大提升了仿真建模效率。</p>
                        
                        <h4 class="mt-4">下载与安装指南 (Syslab)</h4>
                        <ol class="install-steps">
                            <li>
                                <strong>下载 APP 文件:</strong>
                                <p>从 GitHub 仓库下载所有 APP 安装文件 (一个包含 .exe 和依赖项的文件夹)。</p>
                                <a href="https://github.com/polarbearYc/syslabapp.git" class="btn btn-success" target="_blank">
                                    <i class="fab fa-github me-2"></i>访问 GitHub 仓库
                                </a>
                            </li>
                            <li>
                                <strong>放置 APP 文件夹:</strong>
                                <p>将下载并解压的 APP 文件夹（例如 `CstModelerTool`）复制到 Syslab 推荐的用户 APP 目录中：<br><code>C:/Users/Public/TongYuan/syslab-julia/Apps/</code></p>
                            </li>
                            <li>
                                <strong>注册 APP:</strong>
                                <p>打开 Syslab，点击顶部 Ribbon 菜单的 "APP" -> "安装 APP"。</p>
                            </li>
                            <li>
                                <strong>填写配置:</strong>
                                <p>在弹出的对话框中，填写以下**关键信息**：</p>
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item"><b>APP 名称:</b> <code>CST 建模工具</code> (必须与启动脚本匹配)</li>
                                    <li class="list-group-item"><b>APP 启动脚本:</b> <code>SyslabApp.start("CST 建模工具")</code></li>
                                    <li class="list-group-item"><b>APP 可执行文件路径:</b> (点击“浏览”，选择您在步骤2中放置的 `.exe` 文件)</li>
                                    <li class="list-group-item"><b>APP 图标:</b> (可选, 浏览并选择文件夹中的 `.ico` 文件)</li>
                                </ul>
                            </li>
                            <li>
                                <strong>完成:</strong>
                                <p>点击“确定”。您的 APP 图标现在会出现在 Syslab 的 "APP" 菜单页中，点击即可运行。</p>
                            </li>
                        </ol>
                    </div>
                    <div class="col-md-5">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">APP 概览</h5>
                                <p class="card-text">一个基于 PyQt5 和 Syslab SDK 开发的桌面应用，用于自动化电磁仿真建模。</p>
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-check-circle text-success me-2"></i>相位计算</li>
                                    <li><i class="fas fa-check-circle text-success me-2"></i>VBS 脚本导出</li>
                                    <li><i class="fas fa-check-circle text-success me-2"></i>100% 离线运行</li>
                                    <li><i class="fas fa-check-circle text-success me-2"></i>Syslab 工作区交互</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- (新) 页面3: 工具箱详情页 (Syslab 动力学) -->
            <div id="page-tool-kinetics" class="workspace-page tool-detail-page">
                <button class="btn btn-light btn-sm btn-back" data-target="toolbox"><i class="fas fa-arrow-left me-2"></i>返回工具箱</button>
                <div class="section-title mt-3">
                    <i class="fas fa-chart-line" style="color: #34a853;"></i>
                    <span>化学动力学Pro (A + B ⇌ C + D)</span>
                </div>
                 <div class="row">
                    <div class="col-md-7">
                        <h4>功能介绍</h4>
                        <p>本工具是为物理化学教学和研究而开发的 Syslab 桌面应用 (APP)。它提供了一个交互式沙盒，用于模拟高级的**二级可逆反应 (`A + B ⇌ C + D`)**。</p>
                        <p>APP 采用专业的 Python 科学计算库 (<strong>SciPy</strong>) 作为后端求解器，通过高精度常微分方程 (ODE) 求解器实时计算四种物质（A, B, C, D）的浓度变化。用户可以通过滑动条**实时调整正向速率 (`kf`) 和逆向速率 (`kr`)**，并立即在图表上观察到“化学平衡”的移动。APP 还会自动计算并显示关键的**平衡常数 (`K_eq`)**。</p>
                        
                        <h4 class="mt-4">下载与安装指南 (Syslab)</h4>
                        <ol class="install-steps">
                            <li>
                                <strong>下载 APP 文件:</strong>
                                <p>从 GitHub 仓库下载所有 APP 安装文件 (一个包含 .exe 和依赖项的文件夹)。</p>
                                <a href="https://github.com/polarbearYc/syslab2.git" class="btn btn-success" target="_blank">
                                    <i class="fab fa-github me-2"></i>访问 GitHub 仓库
                                </a>
                            </li>
                            <li>
                                <strong>放置 APP 文件夹:</strong>
                                <p>将下载并解压的 APP 文件夹（例如 `KineticsSimPro`）复制到 Syslab 推荐的用户 APP 目录中：<br><code>C:/Users/Public/TongYuan/syslab-julia/Apps/</code></p>
                            </li>
                            <li>
                                <strong>注册 APP:</strong>
                                <p>打开 Syslab，点击顶部 Ribbon 菜单的 "APP" -> "安装 APP"。</p>
                            </li>
                            <li>
                                <strong>填写配置:</strong>
                                <p>在弹出的对话框中，填写以下**关键信息**：</p>
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item"><b>APP 名称:</b> <code>化学动力学Pro</code> (必须与启动脚本匹配)</li>
                                    <li class="list-group-item"><b>APP 启动脚本:</b> <code>SyslabApp.start("化学动力学Pro")</code></li>
                                    <li class="list-group-item"><b>APP 可执行文件路径:</b> (点击“浏览”，选择您在步骤2中放置的 `.exe` 文件)</li>
                                </ul>
                            </li>
                            <li>
                                <strong>完成:</strong>
                                <p>点击“确定”。您的 APP 图标现在会出现在 Syslab 的 "APP" 菜单页中，点击即可运行。</p>
                            </li>
                        </ol>
                    </div>
                    <div class="col-md-5">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">APP 概览</h5>
                                <p class="card-text">一个基于 PyQt5, Matplotlib 和 SciPy 开发的桌面应用，用于高级化学动力学模拟。</p>
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-check-circle text-success me-2"></i>SciPy 高精度求解</li>
                                    <li><i class="fas fa-check-circle text-success me-2"></i>实时参数调整</li>
                                    <li><i class="fas fa-check-circle text-success me-2"></i>化学平衡可视化</li>
                                    <li><i class="fas fa-check-circle text-success me-2"></i>100% 离线运行</li>
                                    <li><i class="fas fa-check-circle text-success me-2"></i>Syslab 工作区交互</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 页面4: 完整工具箱页 (保留所有工具) -->
            <div id="page-toolbox" class="workspace-page">
                <div class="toolbox-section">
                    <div class="section-title">
                        <i class="fas fa-toolbox"></i>
                        <span>化学工具箱</span>
                    </div>
                    <div class="toolbox-grid">
                        <!-- (真实) CST 建模 APP -->
                        <div class="toolbox-item" data-tool="syslab-cst">
                            <div class="toolbox-icon" style="background-color: #0d47a1;">
                                <i class="fas fa-cube"></i>
                            </div>
                            <div class="toolbox-name">CST 超表面建模</div>
                            <div class="toolbox-desc">相位计算并生成VBS脚本 (Syslab APP)</div>
                        </div>
                        <!-- (真实) 动力学 APP -->
                        <div class="toolbox-item" data-tool="syslab-kinetics">
                            <div class="toolbox-icon" style="background-color: #34a853;">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="toolbox-name">化学动力学Pro</div>
                            <div class="toolbox-desc">A+B ⇌ C+D 可逆反应模拟 (Syslab APP)</div>
                        </div>
                        
                        <!-- (保留的模拟工具, 为了"工作量") -->
                        <div class="toolbox-item" data-tool="orbital">
                            <div class="toolbox-icon">
                                <i class="fas fa-atom"></i>
                            </div>
                            <div class="toolbox-name">分子轨道可视化</div>
                            <div class="toolbox-desc">原子轨道分布图和电子云可视化</div>
                        </div>
                        <div class="toolbox-item" data-tool="titration">
                            <div class="toolbox-icon">
                                <i class="fas fa-vial"></i>
                            </div>
                            <div class="toolbox-name">酸碱滴定优化</div>
                            <div class="toolbox-desc">利用AI优化实验减小误差</div>
                        </div>
                        <div class="toolbox-item" data-tool="electrochemistry">
                            <div class="toolbox-icon">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <div class="toolbox-name">电化学参数计算</div>
                            <div class="toolbox-desc">最小二乘迭代解法计算动力学参数</div>
                        </div>
                        <div class="toolbox-item" data-tool="reaction-path">
                            <div class="toolbox-icon">
                                <i class="fas fa-project-diagram"></i>
                            </div>
                            <div class="toolbox-name">反应路径规划</div>
                            <div class="toolbox-desc">基于多智能体系统的合成路径优化</div>
                        </div>
                        <div class="toolbox-item" data-tool="catalyst">
                            <div class="toolbox-icon">
                                <i class="fas fa-calculator"></i>
                            </div>
                            <div class="toolbox-name">催化剂预测</div>
                            <div class="toolbox-desc">机器学习算法选择合成氨催化剂</div>
                        </div>
                        <div class="toolbox-item" data-tool="molecule-analysis">
                            <div class="toolbox-icon">
                                <i class="fas fa-database"></i>
                            </div>
                            <div class="toolbox-name">有机分子数据分析</div>
                            <div class="toolbox-desc">从PubChem/ChEMBL采集数据</div>
                        </div>
                        <div class="toolbox-item" data-tool="structure-prediction">
                            <div class="toolbox-icon">
                                <i class="fas fa-shapes"></i>
                            </div>
                            <div class="toolbox-name">分子结构预测</div>
                            <div class="toolbox-desc">基于AI的分子3D结构预测与优化</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 页面5: 完整案例库页 -->
            <div id="page-cases" class="workspace-page">
                <div class="case-library">
                    <div class="section-title">
                        <i class="fas fa-book"></i>
                        <span>AI+化学 案例文献库</span>
                    </div>
                    
                    <!-- 搜索筛选区 -->
                    <div class="filter-section">
                        <div class="row g-2">
                            <div class="col-md-5">
                                <input type="text" class="form-control" id="search-input" placeholder="在 40+ 篇文献中搜索...">
                            </div>
                            <div class="col-md-4">
                                <select class="form-select" id="domain-filter">
                                    <!-- JS 动态加载 -->
                                </select>
                            </div>
                            <div class="col-md-3">
                                <select class="form-select" id="tech-filter">
                                    <!-- JS 动态加载 -->
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- (新) 案例展示区 (列表) -->
                    <div class="list-group" id="cases-container-full">
                        <!-- JS 动态加载 -->
                    </div>
                </div>
            </div>

            <!-- 页面6: AI 助手页 -->
            <div id="page-ai-lab" class="workspace-page">
                <!-- AI聊天框 (完整页) -->
                <div class="ai-chatbox" id="ai-chatbox-full">
                    <div class="chat-header">
                        <i class="fas fa-robot"></i>
                        <span>化学AI助手 (模拟)</span>
                    </div>
                    <div class="chat-messages" id="chat-messages-full">
                        <div class="message ai">
                            您好！我是化学AI助手，可以回答您关于化学计算、分子可视化等各种问题。
                        </div>
                    </div>
                    <div class="chat-input">
                        <input type="text" id="chat-input-full" placeholder="输入您的问题...">
                        <button id="send-message-full"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>

        </main>
    </div>
    
    <!-- 模态框 (用于帮助和未实现的工具) -->
    <div class="modal" id="tool-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-modal-button">&times;</span>
            <div class="modal-title" id="modal-title">工具详情</div>
            <div id="modal-content">
                <!-- JS 动态加载 -->
            </div>
        </div>
    </div>

    <!-- 外部 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- (新) 所有 JS 合并到此处 -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {

            // --- (新) 案例库数据 (包含您新增的40篇) ---
            const cases = [
                // --- 您的原始案例 ---
                {
                    id: 1, title: "Halicin抗生素发现", domain: "药物发现", technique: "生成模型",
                    description: "MIT使用生成对抗网络发现新型广谱抗生素Halicin，可对抗耐药菌。效果提升: 90%",
                    source: "https://www.cell.com/cell/fulltext/S0092-8674(20)30102-1"
                },
                {
                    id: 2, title: "MOF催化剂筛选", domain: "催化化学", technique: "GNN",
                    description: "伯克利实验室开发3D-GNN模型，筛选出CO2还原性能提升40%的Ni-MOF催化剂。效果提升: 40%",
                    source: "https://www.science.org/doi/10.1126/science.aax1566"
                },
                {
                    id: 3, title: "逆合成路线规划 (IBM RXN)", domain: "合成化学", technique: "NLP",
                    description: "IBM RXN系统使用Transformer模型实现80%准确率的逆合成分析。效果提升: 10倍",
                    source: "https://pubs.acs.org/doi/10.1021/acscentsci.9b00576"
                },
                {
                    id: 4, title: "流动化学优化 (MIT)", domain: "合成化学", technique: "RL",
                    description: "MIT开发强化学习系统，自动优化流动化学反应条件。收率从68%提升至89%",
                    source: "https://www.science.org/doi/10.1126/science.aay2387"
                },
                {
                    id: 5, title: "钙钛矿材料设计", domain: "材料化学", technique: "机器学习",
                    description: "通过机器学习预测钙钛矿太阳能电池材料的带隙和稳定性。筛选效率提升: 50倍",
                    source: "https://www.nature.com/articles/s41560-021-00839-0"
                },
                {
                    id: 6, title: "分子生成与优化 (Insilico)", domain: "药物发现", technique: "生成模型",
                    description: "Insilico Medicine使用生成式AI设计新型纤维化药物分子。临床前实验显示显著活性",
                    source: "https://www.nature.com/articles/s41587-019-0224-x"
                },
                // --- 您新增的 40 个案例 ---
                {
                    id: 7, title: "荧光COF材料发现", domain: "材料化学", technique: "AI预测",
                    description: "结合高通量筛选和机器学习，发现具有优异荧光性能的共价有机框架（COF）材料。",
                    source: "https://www.nature.com/articles/s41557-025-01974-x"
                },
                {
                    id: 8, title: "Prompt2Poly：AI设计聚合物", domain: "材料化学", technique: "生成模型",
                    description: "使用基于提示（Prompt）的生成模型，根据所需的性质描述自动设计聚合物。",
                    source: "https://pubs.rsc.org/en/content/articlelanding/2025/py/d5py00921a/unauth"
                },
                {
                    id: 9, title: "GATE材料发现框架", domain: "材料化学", technique: "AI预测",
                    description: "一个可泛化的AI框架，结合物理化学知识，用于加速新材料的发现。",
                    source: "https://quantumzeitgeist.com/learning-gate-framework-enables-generalizable-materials-discovery-jointly-physicochemical/"
                },
                {
                    id: 10, title: "AI驱动X射线光谱分析", domain: "物理化学", technique: "AI预测",
                    description: "利用AI模型解析复杂的X射线光谱数据，以确定材料的电子结构。",
                    source: "https://www.nature.com/articles/s41524-025-01771-7"
                },
                {
                    id: 11, title: "AI在化学药物发现中的应用潜力", domain: "药物发现", technique: "AI预测",
                    description: "综述AI技术（如深度学习）在药物靶点识别、分子筛选和设计中的应用。",
                    source: "https://ieeexplore.ieee.org/document/10568743"
                },
                {
                    id: 12, title: "AI预测有机反应的合适条件", domain: "合成化学", technique: "AI预测",
                    description: "开发AI模型，通过分析大量文献数据，预测给定反应的最佳溶剂、温度和催化剂。",
                    source: "https://pubs.acs.org/doi/10.1021/acscentsci.8b00357"
                },
                {
                    id: 13, title: "化学反应产量预测 (IEEE)", domain: "合成化学", technique: "AI预测",
                    description: "使用机器学习模型，根据反应物和条件预测化学反应的最终产率。",
                    source: "https://ieeexplore.ieee.org/document/9440947"
                },
                {
                    id: 14, title: "有机反应结果的预测", domain: "合成化学", technique: "AI预测",
                    description: "利用AI模型，在反应进行前预测主要产物的结构，加速合成路线探索。",
                    source: "https://pubs.acs.org/doi/10.1021/acscentsci.7b00064"
                },
                {
                    id: 15, title: "定量构效关系 (QSAR)", domain: "化学信息学", technique: "机器学习",
                    description: "综述QSAR模型的发展，利用分子结构描述符来预测其生物活性或物理化学性质。",
                    source: "https://webofscience.clarivate.cn/wos/woscc/full-record/WOS:000349943100007"
                },
                {
                    id: 16, title: "AI预测化学反应结果 (AIChE)", domain: "合成化学", technique: "AI预测",
                    description: "应用AI技术，特别是深度学习，来预测复杂化学反应的产物和产率。",
                    source: "https://aiche.onlinelibrary.wiley.com/doi/10.1002/aic.17190"
                },
                {
                    id: 17, title: "AI在药物发现中的应用 (MDPI)", domain: "药物发现", technique: "AI预测",
                    description: "讨论AI技术，包括机器学习和深度学习，在现代药物发现流程中的多样化应用。",
                    source: "https://www.mdpi.com/1424-8247/16/9/1259"
                },
                {
                    id: 18, title: "蛋白质复合物结构预测 (AlphaFold)", domain: "生物化学", technique: "深度学习",
                    description: "利用深度学习（如AlphaFold-Multimer）高精度预测蛋白质-蛋白质相互作用和复合物结构。",
                    source: "https://www.sciencedirect.com/science/article/pii/S0959440X23000039"
                },
                {
                    id: 19, title: "计算多相催化", domain: "催化化学", technique: "AI预测",
                    description: "结合AI和DFT计算，加速多相催化剂的筛选和机理研究。",
                    source: "https://www.sciencedirect.com/science/article/pii/S0021951724001957"
                },
                {
                    id: 20, title: "优化太阳能电池设计", domain: "材料化学", technique: "AI预测",
                    description: "使用AI模型（如贝叶斯优化）来寻找高效、稳定的有机太阳能电池材料组合。",
                    source: "https://pubs.acs.org/doi/10.1021/acs.jpclett.4c03580"
                },
                {
                    id: 21, title: "选择可行电催化剂", domain: "催化化学", technique: "AI预测",
                    description: "利用AI模型筛选电催化剂，加速例如CO2还原或析氢反应 (HER) 的催化剂开发。",
                    source: "https://pubs.rsc.org/en/content/articlelanding/2024/ta/d4ta04991h"
                },
                {
                    id: 22, title: "辅助催化剂优化", domain: "催化化学", technique: "AI预测",
                    description: "综述机器学习在催化剂设计和优化中的应用，包括活性预测和机理探索。",
                    source: "https://pubs.acs.org/doi/10.1021/acscatal.0c05661"
                },
                {
                    id: 23, title: "二氧化钛光催化降解空气污染物预测", domain: "催化化学", technique: "AI预测",
                    description: "开发AI模型预测TiO₂在光催化下降解挥发性有机物（VOCs）的效率。",
                    source: "https://www.sciencedirect.com/science/article/pii/S2590123024008922"
                },
                {
                    id: 24, title: "光催化水分解制氢深度学习预测", domain: "催化化学", technique: "深度学习",
                    description: "使用深度学习模型预测不同催化剂在自然光下光催化水分解制氢的效率。",
                    source: "https://www.sciencedirect.com/science/article/pii/S0196890423013535"
                },
                {
                    id: 25, title: "一氧化碳的整合捕获和转化 (ICCAT)", domain: "催化化学", technique: "AI预测",
                    description: "研究和预测用于CO₂捕获和原位转化为有价值化学品（如甲醇）的双功能材料。",
                    source: "https://www.sciencedirect.com/science/article/pii/S2666546824000272"
                },
                {
                    id: 26, title: "探索预测掺杂ZnO带隙的建模技术", domain: "材料化学", technique: "机器学习",
                    description: "比较不同的机器学习模型（如ANN, SVM）在预测掺杂氧化锌（ZnO）半导体带隙方面的准确性。",
                    source: "https://www.sciencedirect.com/science/article/pii/S0301010425000047"
                },
                {
                    id: 27, title: "动态电池类型检测", domain: "材料化学", technique: "AI预测",
                    description: "使用AI算法根据电池充放电曲线动态识别电池类型和健康状态（SOH）。",
                    source: "https://ieeexplore.ieee.org/document/10374630"
                },
                {
                    id: 28, title: "无机化学反应预测", domain: "合成化学", technique: "AI预测",
                    description: "开发模型预测高温固相反应等无机化学反应的产物。",
                    source: "https://ieeexplore.ieee.org/document/10986863"
                },
                {
                    id: 29, title: "AI应用于逆合成预测及药物化学", domain: "药物发现", technique: "AI预测",
                    description: "综述AI在逆合成分析和药物化学中的最新进展，特别是在先导化合物优化方面。",
                    source: "https://pubs.acs.org/doi/10.1021/acs.jmedchem.4c02749"
                },
                {
                    id: 30, title: "电池优化 (IEEE)", domain: "材料化学", technique: "AI预测",
                    description: "利用AI模型优化电池管理系统（BMS）和电极材料设计，以延长电池寿命。",
                    source: "https://ieeexplore.ieee.org/document/10837428"
                },
                {
                    id: 31, title: "对化学系统进行预测性洞察 (Chem. Rev.)", domain: "化学信息学", technique: "机器学习",
                    description: "（综述）利用机器学习从大型化学数据集中提取洞察，预测反应性和材料性质。",
                    source: "https://pubs.acs.org/doi/10.1021/acs.chemrev.1c00107"
                },
                {
                    id: 32, title: "分子和材料科学 (Nature)", domain: "材料化学", technique: "机器学习",
                    description: "（综述）机器学习在加速分子和材料科学发现中的应用，包括性质预测和结构生成。",
                    source: "https://www.nature.com/articles/s41586-018-0337-2"
                },
                {
                    id: 33, title: "探索化合物空间 (Nature)", domain: "化学信息学", technique: "机器学习",
                    description: "（综述）如何使用机器学习和AI技术来探索广阔的化学化合物空间，寻找新分子。",
                    source: "https://www.nature.com/articles/s41570-020-0189-9"
                },
                {
                    id: 34, title: "分子性质预测 (Scopus)", domain: "化学信息学", technique: "AI预测",
                    description: "利用AI模型（如GNN）从分子图结构中直接预测其物理化学性质。",
                    source: "https://www.scopus.com/pages/publications/85158082388?inward="
                },
                {
                    id: 35, title: "化学反应预测 (ACS)", domain: "合成化学", technique: "AI预测",
                    description: "（综述）早期关于使用AI和数据驱动方法预测化学反应产物的尝试。",
                    source: "https://pubs.acs.org/doi/10.1021/ci200207y"
                },
                {
                    id: 36, title: "在机制层面预测复杂化学反应", domain: "合成化学", technique: "AI预测",
                    description: "开发不仅预测产物，还能预测反应机理和过渡态的AI模型。",
                    source: "https://pubs.acs.org/doi/10.1021/ci3003039"
                },
                {
                    id: 37, title: "预测有机化学反应 (ACSCentSci)", domain: "合成化学", technique: "深度学习",
                    description: "使用深度神经网络，通过“学习”大量已知反应来预测未知反应的结果。",
                    source: "https://pubs.acs.org/doi/10.1021/acscentsci.6b00219"
                },
                {
                    id: 38, title: "规划化学合成 (Nature)", domain: "合成化学", technique: "AI预测",
                    description: "开发AI系统，自动进行逆合成分析，规划出从简单起始原料到复杂目标分子的合成路线。",
                    source: "https://www.nature.com/articles/nature25978"
                },
                {
                    id: 39, title: "构建过渡金属纳米颗粒的势能表面", domain: "物理化学", technique: "机器学习",
                    description: "使用机器学习（如神经网络势）来构建高精度的过渡金属纳米颗粒势能表面，用于动力学模拟。",
                    source: "https://ieeexplore.ieee.org/document/5366470"
                },
                {
                    id: 40, title: "合成有机化学中的逆合成分析混合系统", domain: "合成化学", technique: "AI预测",
                    description: "结合基于规则的专家系统和AI模型，进行更可靠的逆合成分析。",
                    source: "https://ieeexplore.ieee.org/document/5726552"
                },
                {
                    id: 41, title: "非线性建模 (IEEE)", domain: "化学信息学", technique: "机器学习",
                    description: "在化学信息学中使用非线性建模技术（如神经网络）来处理复杂的构效关系。",
                    source: "https://ieeexplore.ieee.org/document/5359997"
                },
                {
                    id: 42, title: "聚合物性能预测与优化", domain: "材料化学", technique: "AI预测",
                    description: "使用AI模型，根据聚合物的单体和结构来预测其机械性能、热性能等。",
                    source: "https://ieeexplore.ieee.org/document/1650254"
                },
                {
                    id: 43, title: "寻找和优化有机化学反应条件", domain: "合成化学", technique: "AI预测",
                    description: "利用AI算法（如贝叶斯优化）在多维参数空间中快速寻找最佳反应条件。",
                    source: "https://ieeexplore.ieee.org/document/11035048"
                },
                {
                    id: 44, title: "分子性质预测 (IEEE 2024)", domain: "化学信息学", technique: "AI预测",
                    description: "最新的AI模型进展，用于更精确地预测分子的多种性质。",
                    source: "https://ieeexplore.ieee.org/document/10695352"
                },
                {
                    id: 45, title: "分子性质预测 (IEEE 2025)", domain: "化学信息学", technique: "AI预测",
                    description: "（2025年预印）关于使用大型图模型进行分子性质预测的最新研究。",
                    source: "https://ieeexplore.ieee.org/document/10863929"
                },
                {
                    id: 46, title: "预测物质溶解度", domain: "化学信息学", technique: "AI预测",
                    description: "使用机器学习模型，根据分子结构预测其在不同溶剂中的溶解度。",
                    source: "https://ieeexplore.ieee.org/document/9535593"
                },
                {
                    id: 47, title: "加速化学反应 (IEEE)", domain: "合成化学", technique: "AI预测",
                    description: "利用AI进行高通量虚拟筛选和反应条件优化，以加速化学反应的发现。",
                    source: "https://ieeexplore.ieee.org/document/10150643"
                },
                {
                    id: 48, title: "分子设计和优化 (JCIM)", domain: "药物发现", technique: "AI预测",
                    description: "（综述）讨论用于药物设计的分子生成、优化和性质预测的AI方法。",
                    source: "https://pubs.acs.org/doi/10.1021/acs.jcim.2c01191"
                },
                {
                    id: 49, title: "预测化学反应产率 (IOP)", domain: "合成化学", technique: "AI预测",
                    description: "开发机器学习模型，精确预测化学反应的产率，辅助实验决策。",
                    source: "https://iopscience.iop.org/article/10.1088/2632-2153/abc81d"
                }
            ];

            // --- DOM 元素引用 ---
            const navItems = document.querySelectorAll('.nav-menu li');
            const workspacePages = document.querySelectorAll('.workspace-page');
            const toolboxItems = document.querySelectorAll('.toolbox-item');
            const modal = document.getElementById('tool-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalContent = document.getElementById('modal-content');
            const closeModalButton = document.getElementById('close-modal-button');
            const backButtons = document.querySelectorAll('.btn-back');
            
            // 案例库筛选器
            const searchInput = document.getElementById('search-input');
            const domainFilter = document.getElementById('domain-filter');
            const techFilter = document.getElementById('tech-filter');
            const casesContainerFull = document.getElementById('cases-container-full');
            const casesContainerHome = document.getElementById('cases-container-home');

            // AI 聊天
            const chatInputs = {
                'home': document.getElementById('chat-input-home'),
                'full': document.getElementById('chat-input-full')
            };
            const sendButtons = {
                'home': document.getElementById('send-message-home'),
                'full': document.getElementById('send-message-full')
            };
            const chatMessages = {
                'home': document.getElementById('chat-messages-home'),
                'full': document.getElementById('chat-messages-full')
            };

            // --- (新) 导航逻辑 ---
            function navigateToPage(pageId) {
                // 1. 隐藏所有页面
                workspacePages.forEach(page => page.classList.remove('active-page'));
                
                // 2. 激活对应页面
                const targetPageId = `page-${pageId}`;
                const targetPage = document.getElementById(targetPageId);
                
                if (targetPage) {
                    targetPage.classList.add('active-page');
                } else {
                    // Fallback 到首页
                    document.getElementById('page-home').classList.add('active-page');
                }

                // 3. 更新侧边栏菜单的 'active' 状态
                navItems.forEach(item => {
                    item.classList.toggle('active', item.getAttribute('data-page') === pageId);
                });
            }

            // 侧边栏导航点击
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    const pageId = this.getAttribute('data-page');
                    navigateToPage(pageId);
                });
            });

            // (新) 工具箱项目点击
            toolboxItems.forEach(item => {
                item.addEventListener('click', function() {
                    const tool = this.getAttribute('data-tool');
                    
                    if (tool === 'syslab-cst') {
                        // (新) 导航到 CST 详情页
                        navigateToPage('tool-cst');
                        // (新) 同步更新侧边栏到 "工具箱"
                        navItems.forEach(nav => nav.classList.toggle('active', nav.getAttribute('data-page') === 'toolbox'));
                    } else if (tool === 'syslab-kinetics') {
                        // (新) 导航到 动力学 详情页
                        navigateToPage('tool-kinetics');
                        // (新) 同步更新侧边栏到 "工具箱"
                        navItems.forEach(nav => nav.classList.toggle('active', nav.getAttribute('data-page') === 'toolbox'));
                    } else {
                        // (保留) 为其他“体现工作量”的工具打开模拟模态框
                        openToolModal(tool);
                    }
                });
            });

            // (新) 工具详情页的 "返回" 按钮
            backButtons.forEach(button => {
                button.addEventListener('click', function() {
                    navigateToPage('toolbox');
                });
            });

            // --- 案例库逻辑 (重构) ---
            function populateFilters() {
                const domains = [...new Set(cases.map(item => item.domain))].sort();
                const techs = [...new Set(cases.map(item => item.technique))].sort();

                domainFilter.innerHTML = '<option value="">所有领域</option>';
                techFilter.innerHTML = '<option value="">所有技术</option>';
                
                domains.forEach(d => domainFilter.innerHTML += `<option value="${d}">${d}</option>`);
                techs.forEach(t => techFilter.innerHTML += `<option value="${t}">${t}</option>`);
            }

            // (新) 重写为列表视图
            function renderCases(container, caseList) {
                if (!container) return;
                container.innerHTML = '';
                if (caseList.length === 0) {
                    container.innerHTML = '<p class="text-muted p-3">未找到匹配的案例。</p>';
                    return;
                }

                caseList.forEach(item => {
                    const caseHTML = `
                        <div class="list-group-item case-list-item">
                            <div class="case-title">${item.title}</div>
                            <div class="case-description">${item.description}</div>
                            <div class="case-footer">
                                <div class="case-tags">
                                    <span class="badge bg-primary tech-tag">${item.domain}</span>
                                    <span class="badge bg-secondary tech-tag">${item.technique}</span>
                                </div>
                                <a href="${item.source}" target="_blank" class="case-link">
                                    查看文献 <i class="fas fa-external-link-alt fa-xs"></i>
                                </a>
                            </div>
                        </div>
                    `;
                    container.innerHTML += caseHTML;
                });
            }

            function filterAndRenderCases() {
                const domain = domainFilter.value;
                const tech = techFilter.value;
                const search = searchInput.value.toLowerCase();

                const filtered = cases.filter(item => {
                    return (!domain || item.domain === domain) &&
                           (!tech || item.technique === tech) &&
                           (!search || item.title.toLowerCase().includes(search) ||
                                       item.description.toLowerCase().includes(search));
                });

                // 渲染完整列表
                renderCases(casesContainerFull, filtered);
                
                // (新) 渲染首页的精简列表 (只显示前5个)
                renderCases(casesContainerHome, filtered.slice(0, 5));
            }

            // --- 模态框逻辑 (保留, 用于“体现工作量”) ---
            // (这是您原始代码中的逻辑，我已保留)
            function openToolModal(tool) {
                let title = '工具详情';
                let content = '<p>此工具详情将在后续版本中提供。</p>';

                switch(tool) {
                    case 'orbital':
                        title = '分子轨道可视化 (模拟)';
                        content = `
                            <h3>原子轨道分布图和电子云可视化</h3>
                            <p>此工具可以展示不同量子数的原子轨道分布图和电子云密度图。</p>
                            <div class="molecule-viewer"></div>
                            <div class="alert alert-info mt-3">
                                <i class="fas fa-info-circle"></i> 
                                这是一个功能原型。完整的工具请在 "Syslab APP 工具箱" 中查找并下载。
                            </div>
                        `;
                        break;
                    
                    case 'titration':
                        title = '酸碱滴定优化工具 (模拟)';
                        content = `
                            <h3>利用AI优化酸碱滴定实验</h3>
                            <p>此工具可以通过AI算法分析滴定数据，自动校正误差，提高实验精度。</p>
                            <div class="molecule-viewer" style="height: 250px;"></div>
                            <button class="btn btn-primary w-100 mt-2" onclick="alert('正在模拟AI优化...')">开始优化分析</button>
                        `;
                        break;
                    
                    case 'electrochemistry':
                        title = '电化学参数计算 (模拟)';
                        content = `
                            <h3>最小二乘迭代解法计算动力学参数</h3>
                            <p>此工具可以计算交换电流密度、传递系数等电化学动力学参数。</p>
                            <div class="molecule-viewer" style="height: 250px;"></div>
                            <button class="btn btn-primary w-100 mt-2" onclick="alert('正在模拟计算...')">计算动力学参数</button>
                        `;
                        break;

                    case 'reaction-path':
                        title = '反应路径规划 (模拟)';
                        content = `
                            <h3>基于多智能体系统的合成路径优化</h3>
                            <p>此工具可以自动规划最优的有机合成路线，考虑收率、成本和环保性。</p>
                            <div class="molecule-viewer" style="height: 250px;"></div>
                            <button class="btn btn-primary w-100 mt-2" onclick="alert('正在模拟AI规划...')">规划合成路径</button>
                        `;
                        break;

                    case 'catalyst':
                        title = '催化剂预测 (模拟)';
                        content = `
                            <h3>机器学习算法选择合成氨催化剂</h3>
                            <p>此工具可以预测不同金属组合对合成氨反应的催化活性。</p>
                            <div class="molecule-viewer" style="height: 250px;"></div>
                            <button class="btn btn-primary w-100 mt-2" onclick="alert('正在模拟预测...')">预测催化活性</button>
                        `;
                        break;

                    case 'molecule-analysis':
                        title = '有机分子数据分析 (模拟)';
                        content = `
                            <h3>从PubChem/ChEMBL采集数据并计算分子性质</h3>
                            <p>此工具可以从公开数据库下载分子数据，并计算分子量、LogP、极化率等物理化学性质。</p>
                            <div class="alert alert-warning mt-3">
                                <i class="fas fa-info-circle"></i> 
                                <b>网络功能受限。</b><br>
                                建议下载并使用功能更强大的 <b>"化学动力学Pro"</b> 或 <b>"CST 建模"</b> Syslab APP (返回工具箱主页查看)。
                            </div>
                        `;
                        break;

                    case 'structure-prediction':
                        title = '分子结构预测 (模拟)';
                        content = `
                            <h3>基于AI的分子3D结构预测与优化</h3>
                            <p>此工具可以根据分子式或SMILES预测最稳定的3D分子构型。</p>
                            <div class="molecule-viewer"></div>
                            <button class="btn btn-primary w-100 mt-2" onclick="alert('正在模拟预测...')">预测结构</button>
                        `;
                        break;
                    
                    case 'help': // (新) 帮助模态框
                        title = '帮助中心';
                        content = `
                            <h5>欢迎使用 AI 化学工具箱</h5>
                            <p>这是一个用于展示 AI 在化学领域应用的前端门户网站。</p>
                            <ul>
                                <li><b>工具箱:</b> 包含一系列可交互的化学工具。我们推荐下载并使用功能完善的 <b>Syslab APP</b> (如 CST 建模, 动力学Pro)。</li>
                                <li><b>案例库:</b> 汇集了 AI+化学领域的最新顶级科研文献。</li>
                                <li><b>AI 助手:</b> 一个模拟的聊天机器人，用于展示 AI 交互的潜力。</li>
                            </ul>
                        `;
                        break;
                }
                
                modalTitle.textContent = title;
                modalContent.innerHTML = content;
                modal.style.display = 'flex';
            }

            closeModalButton.addEventListener('click', () => modal.style.display = 'none');
            window.addEventListener('click', (event) => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });

            // (新) 帮助按钮现在打开模态框
            document.getElementById('help-button').addEventListener('click', () => openToolModal('help'));

            // --- AI 聊天逻辑 (保留模拟) ---
            function setupChat(id) {
                const input = chatInputs[id];
                const button = sendButtons[id];
                const messages = chatMessages[id];

                if (!input || !button || !messages) return;

                function addMessage(text, sender) {
                    const messageDiv = document.createElement('div');
                    messageDiv.classList.add('message', sender);
                    messageDiv.textContent = text;
                    messages.appendChild(messageDiv);
                    messages.scrollTop = messages.scrollHeight;
                }

                function sendMessage() {
                    const message = input.value.trim();
                    if (message === '') return;
                    
                    addMessage(message, 'user');
                    input.value = '';
                    
                    setTimeout(() => {
                        const responses = [
                            "这是一个很好的问题。您可以在'案例库'中查找相关文献。",
                            "根据我的分析，您提到的功能与'CST 超表面建模' APP 相关，您可以在'工具箱'中下载它。",
                            "我是一个模拟助手。如需真实 AI 功能，需要连接到后端 LLM API。",
                            "我建议您查看'化学动力学Pro' APP，它使用 SciPy 进行了高精度模拟。"
                        ];
                        const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                        addMessage(randomResponse, 'ai');
                    }, 1000);
                }

                button.addEventListener('click', sendMessage);
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') sendMessage();
                });
            }
            
            setupChat('home');
            setupChat('full');

            // --- 初始化 ---
            populateFilters();
            filterAndRenderCases();
            navigateToPage('home'); // 默认显示首页
        });
    </script>
</body>
</html>

